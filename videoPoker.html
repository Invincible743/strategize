<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Video Poker Strategy Analyzer</title>

<link rel="icon" href="icon4.png" sizes="512x512">

<style>
:root{
  --bg:#1f2933;
  --panel:#273340;
  --panel-dark:#1b2430;
  --accent:#60a5fa;
  --success:#34d399;
  --warn:#fbbf24;
  --muted:#9ca3af;
  --red:#ef4444;
  --black:#111827;
  --fraction:#7aa2f7;
}

*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Segoe UI,sans-serif;background:var(--bg);color:#e5e7eb}
.container{max-width:1100px;margin:40px auto;padding:30px}
h1{color:var(--accent)}
.panel{background:var(--panel);border-radius:16px;padding:25px;margin-bottom:30px}
.card-inputs{display:flex;gap:14px;flex-wrap:wrap}
.card-box{background:#1b2430;border-radius:14px;padding:10px;width:120px}
.card-visual{height:90px;border-radius:10px;background:#f9fafb;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:600}
.card-visual.red{color:var(--red)}
.card-visual.black{color:var(--black)}
select{width:100%;margin-top:6px;background:#111827;color:#e5e7eb;border:none;padding:6px;border-radius:6px}
button{margin-top:20px;background:var(--accent);border:none;padding:12px 22px;border-radius:10px;font-weight:600;cursor:pointer;color:#081018}
button.secondary{background:#374151;color:#e5e7eb}
button.secondary:disabled{opacity:.4;cursor:not-allowed}
.strategy{margin-top:26px;padding:26px;background:var(--panel-dark);border-radius:18px}
.strategy h3{color:var(--warn)}
.hold-text{color:var(--accent)}
.hand-row{display:flex;justify-content:space-between;border-bottom:1px solid #2f3a47;padding:8px 0}
.fraction{display:flex;flex-direction:column;align-items:center;font-size:12px;color:var(--fraction)}
.fraction span:last-child{border-top:1px solid var(--fraction);margin-top:2px;padding-top:2px}
.percent{color:var(--success)}
</style>
</head>

<body>
<div class="container">
<h1>Video Poker Strategy Analyzer</h1>

<div class="panel">
  <div class="card-inputs" id="inputs"></div>
  <button onclick="analyze()">Analyze</button>
  <span id="calcText" style="margin-left:12px;color:#fbbf24;display:none;">Calculating…</span>
</div>

<div id="results"></div>
<button id="nextBtn" class="secondary" onclick="showNext()">Show next strategy</button>
</div>

<script>
const ranks=['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
const suits=['♠','♣','♥','♦'];

const HAND_VALUE={
  'Royal Flush':250,
  'Straight Flush':50,
  'Four of a Kind':25,
  'Full House':9,
  'Flush':6,
  'Straight':4,
  'Three of a Kind':3,
  'Two Pair':2,
  'One Pair':1
};

let hand=[], strategies=[], shown=0, lastKey='';

function fullDeck(){ return ranks.flatMap(r=>suits.map(s=>r+s)); }

/* INIT */
(function(){
  const defaults=['K♠','K♣','K♥','K♦','2♠'];
  const wrap=document.getElementById('inputs');

  defaults.forEach((card,i)=>{
    const box=document.createElement('div');
    box.className='card-box';
    const vis=document.createElement('div');
    vis.className='card-visual';

    const r=document.createElement('select');
    ranks.forEach(x=>r.append(new Option(x,x)));
    const s=document.createElement('select');
    suits.forEach(x=>s.append(new Option(x,x)));

    r.value=card.slice(0,-1);
    s.value=card.slice(-1);

    function update(){
      const c=r.value+s.value;
      if(hand.some((x,idx)=>idx!==i&&x===c)) return;
      vis.textContent=c;
      vis.className='card-visual '+((s.value==='♥'||s.value==='♦')?'red':'black');
      hand[i]=c;
    }
    r.onchange=s.onchange=update;
    update();

    box.append(vis,r,s);
    wrap.appendChild(box);
  });
})();

/* EVALUATOR */
function evaluate(cards){
  const r=cards.map(c=>c.slice(0,-1));
  const s=cards.map(c=>c.slice(-1));
  const counts={};
  r.forEach(x=>counts[x]=(counts[x]||0)+1);
  const vals=Object.values(counts).sort((a,b)=>b-a);

  const isFlush=new Set(s).size===1;
  const idx=r.map(x=>ranks.indexOf(x)).sort((a,b)=>a-b);
  const isStraight=idx.every((v,i)=>i===0||v===idx[i-1]+1)||idx.toString()==='0,1,2,3,12';

  if(isStraight&&isFlush&&idx[4]===12) return 'Royal Flush';
  if(isStraight&&isFlush) return 'Straight Flush';
  if(vals[0]===4) return 'Four of a Kind';
  if(vals[0]===3&&vals[1]===2) return 'Full House';
  if(isFlush) return 'Flush';
  if(isStraight) return 'Straight';
  if(vals[0]===3) return 'Three of a Kind';
  if(vals[0]===2&&vals[1]===2) return 'Two Pair';
  if(vals[0]===2) return 'One Pair';
  return 'High Card';
}

/* ENGINE (EV BASED) */
function analyze(){
  const key=hand.join(',');
  if(key===lastKey) return;
  lastKey=key;

  document.getElementById('calcText').style.display='inline';
  document.getElementById('results').innerHTML='';
  strategies=[];
  shown=0;

  setTimeout(()=>{
    const deck=fullDeck();

    for(let mask=0;mask<32;mask++){
      const held=[];
      for(let i=0;i<5;i++) if(mask&(1<<i)) held.push(hand[i]);

      const remaining=deck.filter(c=>!hand.includes(c));
      const need=5-held.length;

      const counts={};
      let total=0;
      let ev=0;

      function draw(start,chosen){
        if(chosen.length===need){
          const res=evaluate([...held,...chosen]);
          counts[res]=(counts[res]||0)+1;
          if(HAND_VALUE[res]) ev+=HAND_VALUE[res];
          total++;
          return;
        }
        for(let i=start;i<remaining.length;i++){
          chosen.push(remaining[i]);
          draw(i+1,chosen);
          chosen.pop();
        }
      }
      draw(0,[]);

      strategies.push({
        held,
        counts,
        total,
        ev:ev/total
      });
    }

    strategies.sort((a,b)=>b.ev-a.ev);

    document.getElementById('calcText').style.display='none';
    showNext();
  },50);
}

/* DISPLAY */
function showNext(){
  if(shown>=strategies.length){
    const btn=document.getElementById('nextBtn');
    btn.disabled=true;
    btn.textContent="All Strategies Shown";
    return;
  }

  const s=strategies[shown++];
  const d=document.createElement('div');
  d.className='strategy';

  const rows=Object.entries(s.counts)
    .filter(([k])=>HAND_VALUE[k])
    .map(([k,v])=>({name:k,count:v,prob:v/s.total}))
    .sort((a,b)=>HAND_VALUE[b.name]-HAND_VALUE[a.name]);

  d.innerHTML=`
    <h3>Strategy ${shown}</h3>
    <div class="hold-text">Hold: ${s.held.join(', ')||'Nothing'}</div>

    <div class="hand-row">
      <div style="display:flex;gap:12px;align-items:center;">
        <strong>Total Success</strong>
        <div class="fraction">
          <span>${s.total}</span>
          <span>${s.total}</span>
        </div>
        <div class="percent">100.00%</div>
      </div>
    </div>

    ${rows.map(h=>`
      <div class="hand-row">
        <div>${h.name}</div>
        <div style="display:flex;gap:12px;">
          <div class="fraction"><span>${h.count}</span><span>${s.total}</span></div>
          <div class="percent">${(h.prob*100).toFixed(2)}%</div>
        </div>
      </div>
    `).join('')}
  `;

  document.getElementById('results').appendChild(d);
}
</script>
</body>
</html>
